package dilithium

import (
	"encoding/hex"
	"reflect"
	"testing"
)

const (
	PK1 = "2a2f9323f90bc3cca3142bcc98beaf0212cf26897ced6d85ec45972281eb595ff2cbc00623dfe87bd0e85a12f41ab75dd51f8b742355158aedd2fe9a3edf82e65796d08ecf42c571c86cde98d8124fff99c909cbdce33d272e62aee03ff5cddee07687934c2f529cebb6eacd2041fe10bfc9535be484f38d4915a82449a0bed751de302be0af86593239beb2ad48d128cd97f7b173e6c130d9deca38c8ae084aadbbd721feb337c81d935d9898e35576bc4f6dead3fe2301c4f7665cd352ecae1163fa7f102cc0d4b258c235780459bb58fd34030fdf5a5fd011d60eaaed5c4e2c1dc37f0c601c6c98f8459fc5e5bf75e59fee4a163d5f7619b22185281114da758ec961a38d92f92ea33e686117df107f665214e17effd9c98d625cccf1b39e4657735af8353dc9b1558634626d870ec049ab57b804f958a00925b250e77bcd9214803decb9a6389eaf0599742c436b6a8de5fcef73fabf18ac178fb5033aa27b56b27257bc009fdaa82d37dc1a32591fb7330cdd2950943f6b1acf5466b3a16adad7c2f39407c00a234ef4a87282917018db614cd86552e5cc5d2db2c44ab8977e528669986f65523b6dc733b7ed1d319f8bbd1d20d292542e4d8e418d9e1e9bd965c4d1a1df342e67d627f18e3b02132ec181803f1feb337b4f8909791ff1bd8a2e004afe8f9c6d5b59090a123999d3e49e8088c954b4172b453c8360ce0dc019204d11d668a7aef85b6c8414ac6f656daa51a3c6414ccd9c2f7a62a3993037e99e74108d67ea00d64c20e0df9323b55fac39cdccef6d2b66aacc4fc32dae9bd58952b4abcb00d4feae1c67268fa6ff4753609d80400a9c56d35f3c7dbd5266a4d08eccde9065f3427fba1713e6353def451fef424586cc7d85a3bfc33e7c0b5946b7c4b37569ef8ecef645ffd1281b86151f96b91efecddb05e5b054ff065a499027befade54011242a4b475c48d2ea51e8564c4f32250af8d9d6322c941ed30560f128aa865b55c87557f1a13e78642bca70de727b7d1a362c827cafdcb3d9505fcca39a4b4289439d154920e359b3231e9c7b58bc6e036f33a00421f8c96626a9f8bda45674621c336a0f6c96a2dfcee843fa219c2833733360db594cbc0bc731623d6f75eb92348077788270b9377855af46b8d8c36c171ba265689206ced6b1338c438f1c41f392285428caa2b7d1c275dd4370d76843bf95153cf0359872856159647865b3d7e964baa2ec3f3460c51cfb5fac2eb70f9129cc1e66e9e60b3e665b58f6d6050c9af24f70e6987611c390cdf1c7bafca83a4b024b230d0a371ca17ce782a12c906c7a39a63ba4cc28dce02e39740f47f174064ad28578e8094097ac74a282acace3c8cd07e97b75ac367f9323fa807fe36e5338e282a5ed4567e0c207e37b6d70d0a65cff6ddd42e59211a37a6ef9fc445bc16d548e7b3227fe6c18a037efb1abe5b932b0191457556ebd84fe8003f357a29889b2327d0b64ad9d438f5866e98cbf88cb1547df73e0ec9a8db175355e11e0cc9611379bdd45ffe763bb1a537b0144172b48e13966574e24e7e49627eb6329e6ad07ad3aeb2d4a1ecbe045be20732dc4aa67889d18361ad859acaa90ac6c9cf3774197abe1dc550146cd0c1ac061631e004c50f60266ea788e18b25c46e1e9f590d5e1ca7e267a5583e12019d3f022a4f7d7542a07dc24cab2a04c67da01b9b66d3a0d6111ef9986cdaca7dfd1bf46d2dbc7ba25eaeb76847e06be2b0c02de6a74d55b58e4371beae3ef10f8cb4398fc10325764077e42b6a62ffa7f0edcc74bb0ddbe26f9f5c06ac04d79e50c3bae4ae6d2ea167199b88f0f60460efb5209b77776007b20ec6f072b89b26af6a09c37a23668cc56e5052caee451340794043022e5c05c7ad29ea6fd66993d90ca95f9325a724d7fd1f47485f9f7289123c17318a10a746b7c1e0b71776f3a252f596f7d65adc458e3fe1280a896761047ecaa5e43bac09c3e593a94fa95af828a78314251ea89558dfd0f374c8ed91663605863f21444aa02374596fc68c163a6bc362f5b5abf9cccd94c1f7dc947a89b5c03033758e"
	SK1 = "2a2f9323f90bc3cca3142bcc98beaf0212cf26897ced6d85ec45972281eb595f2ddee00dc0a13a2a78fb047883ea348b4ad173955b9a578f4ebd15428e896b52db84efd5e82f0ab8fece2ada82599cee9cdecef927a4cf23e5036ab2b448320f68646fe842a0ca26ea71de2f54131a9316aa45aa6409579970002866777929032577927659180825a3693594a1713080a71682473424956825432633704210195787921147393a1955232050266a3a79958723951201040983345505811a7671632904a28690a072873207061348444a409914025aa84318295030634665957106338306a56406828846093a605633101945a7267239628216556aa44763a12430071a93083396597398aa7156624326880759a864894089a0759349173800863a9a448a068552143976465a77a136988568226529241123260819a3247330a06115236205301085279408327005a651a76609a62733307a895753519353480712667695a386895313535242939819877745a38012501079638031026555980676987741230464759609aa2671759a54704395040266629a174544109a642282093a3730134663a05746162a1898904839167860745564688160a9831779a00182091a5a24854a22a062145a2913357a0486711a63774998549930053989594a46755a9180857341a49929275452249716a60225649265757a1201829668a07017415922985a26a3a0a99346735891482524440a06538a72257754722750233697a68755974166689a6327077643439485785125308297903107a62736584a2851219a653071324403615406137027a15994617a5033194298769895a693a75375761552477a582226611453123219565175911583067164647866042911a5625786047655122275668a93217aa5579028a033939541a7266611346960361229a45030730aa796486943656a05a88a96a2a22843213307813956952909518666a59282619997743a987086771544532335512896a28543939286820a465a9827340095647639a35349759092a2870121119691151223799598440475371681682159aa6529a797a6562220a30395a784333073958843611a4483a211449507a9724712a672547684143774503334903753431a777a1aa1056975a905a36798873902827399732112284808965136339997817a3484090551030329a21751269975435421a7225203241290974a70152a3a4a6aa716074847743a2057769694979589a24847704164a3a15572a323650789a247a099a254247861996843636698552871783a247629278382a745146a2948677909a82267846645a953087605568688377280342402a9477490417377aaa3530647242a6a0658731279953763aaa23453227098a8661a8293469061653125490141a814416a2398089667850990075373368a404633627370334156364575559a04683633a4089a765310249222a90765a6529a13a201a6a7215998079a2179666943041569906342394639385585a3723aa954734a15038799869518027a9658817a09636875545276a715841743697702086162231284a57236455a4a9229075aa302a59325605073203699620a0051a627418937992249283a7136011278845a89a99476a529017708504a1660a556895167526a8208696a4571067a951338367785976565a25632aa773528a6a0699a684988a46103a89a6291398439581415a8576396034318461587253908080659a7486a29390488960772072417b88b96f01f505c33be5d21df705b9eddc6526ba15d9981b115e95ab7db9fb379a8f5b4b42a2b9c303822f6cafe2fb4f3e901498487351a38ba3388d1494c5ca653704b68276e4a5cecd6cabc19d357727e91c2f255275bfacaa519fb52c17297e26a3bc1ebff1dddba3f08a3f2d5fb973415d860c1cd8553583ee6ddfd77b9c9eec97d7c08a28a443a9d3cbf331ae6c45bd072e101d829f916f3aa5370d196f3d597169da2154c2ab9888f2014da7dbaf4b52c7e77eb63a6cf83ef31730b737e09ac97c8f6672e9b7caf5cf2f7830f5d47e7ce4519c3802d39d452663cd530f64371fb5f502419d134bb919fd1acc32e9f733caee9f134eac7de6778dc8c8fe8ce9f87f87b7e72c62b6fedda6b4b0e282f61aaabe61c458a42bd3a3e9e8d0dcf823dbd28882e5f33bab7246dee98e92e9c4dbf688d495b69ef0835bf6db1101c18cff372c2fa8e11870a9fb5ae6b88bdc7198ea4ba0928370b2ea346ee7c17e51b65183fb27a1ef03e75206caa63872de9ea2bd071840bac9d2a7b391a768cf17e8c9296f653413fc5256d056bc4260b226c8d7b29af6d95a9e19824db2065c185e91df90b830080694889c96bd82dd54f3bb18c18bc0b6fd255e75e6c737d41d80a2c08e48af0ca1cd2e3a03543248b8077e33e88e5da203cbe6a7900813a3cf53d1e58d52eaccade2773cf28bb40083ef705301c3521d32d4cdef0fc9a38b1ee28a9f25c07725a77b10a0cb271911bee596470623d3966495eed524346e1bb4d579e432eb17bb9b1346aa86e64d847bf58a7a52c87c04515e46a619d91917d8467a140b91f50eae21ddcb33ceb305c2541c3722e4cd5f0eb520eb674c1a4674db7dd0f2d28378d8c5ebee5551db8f803b4464c0122c6de8e9f7b8c854cd5f86dc99b749f2d71baabfc32a746b646079be111e96fe301d05d586d5444c23b665cb19fac036a0666b1f0dddce7183d1cf65a525d70ce522ee6eef99d4b2ca5987790b056cd2d1b09d604fde96a6f812042b492923215cd9ebf48542e8dada5a2a9f22feea6b84cc1c73d4cba3e14535b27919f1ce3e8e2686405237c97de08c71439ca4f1beb58036bcbb816ab3b5061e09b826d4f36f62bf7844ca101748e84c8a4f2c79f7939236f38666e66c2b9272365fd27a654b309eb025840089de93134aa8db8a48c50afa40bae1928081f9449fd53b218938b67ec372fcd566890c4de85422c413edc927b6c621608026829715c7eea06cc4943164e179d7a04b6ee2abc90ecf05398e8186008ef03a510f733fbdf4242c458c00012144866718de1dd5970aa3eac991cf176aa578202ef271197e8580756ee6ad85c3435acbd3440c078817d43f3dc1e246036fe546b368d701b53df02873981ecb9f84c6e887704f38de2511fb58e97aa6467ba29734c5cb8539999130e25af860a10b3190274c4398649ebf388d86cbb56ccc7c3ccea1d82d1ad02324256452d15ddff3ed53b788d3e8a049eb7231218fd9e2263539e0b972329300db3a9ec5c13829f5a206bd72e89f3938b782f80cdec67fe55159a04e7beb967f8f475f3a818431adc6e5cfc2e0a349a060ab2c4bb65bda35934ab168da9d0828a6ee13e16bfb597ad2837b84750f011c8e30ecb96c17be70f1f7e588438291113f1f9367210694e6a55889940cb568143d7a587fbe838895efcd70c50e212bb235a1877afab9b42628d7010954193ffd4f05547fde3dceb385443ec4b9a3ec0c00f1c5191d2c2efc2a5a815b9f47a5c138b461d186a407bfefce2f38f453be2deaaab4030424e1ec3ac27783f3737c5b7e5d24ad8a4357d2cca469842befce9a2e457475c94c0e7b6ecbe600721eeb83473ac89309c2c7ad6f31e082ba559df9d8592ad39de2085f79c04425a00555e1dfb1b1d739cc110dfa546787b86df5f416c7e0a5c24302e7a261841a5923934ca6e7d910cc89b96f387e266a1559d60d47eb331e48946ccd9e99b4d48b45eaef081216def5f6880bdc0039ed3f84ccb9a244200641b732ed84d7c38e07e6bb31bb08122c0a42aecbeda33acd00671d2f8140aa39647d9bc58c00fc1095611c84feae6964aa74065cfd4372b0d3c8740efc2c1286bf87b2effceb950d8884628d9b62b2d52631a23980ae9cfeb8475a2d7f73183503546c7bbdf620a97db673153dec8b9be3a82a6b95dd0d8718b462c7392ba9a9644dfb27fdcb120f58d102374243f8d59eb7db7b5d8ed7272491de3cd7c5eada1ebf2015983c10613bce63c2b863a31cac96034c221377a197f648b3544656e1a6c0e5feb0c9c2a4ac1810e297729917330a048d92ff13cea219ae0425b8ca5ee9ec551737237bacda1abaa7f07bf814219e294021cc4acf2ed35f7dc49d9a1f3148b74440a5b91be03e26713317e5aedf3c2d2805189c9268d5f4237067d5776907903857b2738293ca153c440e0711bc010991dfaff49becec4a01e78ef12a0eda672bf77e1f32a7992adc9e5fc961477c23680f95ca5ec06876a9cede57d46cc38d501183ed8639aa31721e98b74cf0f327a4df90fd0848d141e3e4faff643a8a72b9d4751d2e22528ed1e6cd9581a05517ce78703aab97c8b4ff45b718314b6af58fe93f16407767d82cd66f8253fa5536a86108afe349f5e80ab32ab015e60e2966435f59e5bb37595318a30500cd1199a926e18b2c6fe1f70c1fabaf43efa0ef498b60f12220d592a1442d6e3c137eed6c75d3220b1bde294d28472dc558339c2777ba40241127a8090fa6ecaff3480508d42f77662a64b3d1f2b0edf2f616dd8c70634e1b71b78c08fc24cacae67f9fd9107312417b5769736c6565733c8ad9baec1d707d97216d7f22b0b94f0d5a0491fe12f6ea879e4c829e5d09c2e20c1c1b7cf2e1b1790d6881e0e5e590d42e97297255db650be708103557288daf156866d40fad665d7c784d9a3b34e8fea392396ad1d36a4ede03e8b74e8142d264cb437076b8e949a4c3ecd913a41c46ef1c14f12869e36448be6626a6bba95d29bcd94a67921ae168f7094ecf062154460def04b0afcf5d10306f1fd87874a9f1e992e7f22052436134bfa35359815a2421af6d2c67f8aeebada50ae643df807fd8a250d9d6e5463260b8fb2e11e9d8169981cde2848b0b67479b8abc756e5692d38888032"
)

func PKHStrToBin(pkHStr string) [PKSizePacked]uint8 {
	if len(pkHStr) != 2*PKSizePacked {
		panic("Invalid pkHStr")
	}
	var pk [PKSizePacked]uint8
	pkDecode, _ := hex.DecodeString(pkHStr)

	for i := 0; i < len(pkDecode); i++ {
		pk[i] = pkDecode[i]
	}
	return pk
}

func SKHStrToBin(skHStr string) [SKSizePacked]uint8 {
	if len(skHStr) != 2*SKSizePacked {
		panic("Invalid skHStr")
	}
	var sk [SKSizePacked]uint8
	skDecode, _ := hex.DecodeString(skHStr)

	for i := 0; i < len(skDecode); i++ {
		sk[i] = skDecode[i]
	}
	return sk
}

func TestNew(t *testing.T) {
	defer func() {
		if err := recover(); err != nil {
			t.Error("Panic while creating dilithium ", err)
		}
	}()
	New()
}

func TestNewFromKeys(t *testing.T) {
	defer func() {
		if err := recover(); err != nil {
			t.Error("Panic while creating dilithium ", err)
		}
	}()
	var pk [PKSizePacked]uint8
	var sk [SKSizePacked]uint8
	NewFromKeys(&pk, &sk)
}

func TestDilithium_GetPK(t *testing.T) {
	pk := PKHStrToBin(PK1)
	sk := SKHStrToBin(SK1)
	d := NewFromKeys(&pk, &sk)

	if !reflect.DeepEqual(pk, d.GetPK()) {
		t.Error("PK Mismatch")
	}
}

func TestDilithium_GetSK(t *testing.T) {
	pk := PKHStrToBin(PK1)
	sk := SKHStrToBin(SK1)
	d := NewFromKeys(&pk, &sk)

	if !reflect.DeepEqual(sk, d.GetSK()) {
		t.Error("SK Mismatch")
	}
}

func TestDilithium_Seal(t *testing.T) {
	pk := PKHStrToBin(PK1)
	sk := SKHStrToBin(SK1)
	msg := []uint8{0, 1, 2, 4, 6, 9, 1}
	d := NewFromKeys(&pk, &sk)
	signatureMessage := d.Seal(msg)

	expectedSigMsg := "8c7c0ffc1dfd5b7de11e9c21c6274855bee171fc5022a70eb60da13ef1389f10ab435f06f39f46099802ac8aafaec59396ddcfd75f7e4cbdab72679b82d2e4e12584513b8c1f62cd4cd4b769debb9a47be2979a1f92c2f5b85827bd1495179bf1150bc773e670880c9183fe4123661dd18e413d53db17fb012a0d2db35ec73e1e8210f65960bbf00a599216f5ef60e7a0ce9b19e020803edeec074254a7a4c46591eeee6e6b13ea129493695987cfdea5e2c7b5ee3343bba46590178f74ad54375ff67b6b0541e6a94c378deb4a670413a1920810ada665047709ad4c95261c6aff1920945a9107d7c5cd243166e6f8a5cea8d3aa4ab75eae6a70e78d89342861f170b40d4af8ff0e283c2a631763a8ccc5870cac7e449f2a0bb4470520671ee35b061e8fb704fb341f9deb0edc7a3c912611c8c51a8180835251574b351e5bc2baa28f0c1904e764c5b880c421bcb22ce92d178e1aa5124ad78962c230b7d6ab78c02ef3a4365f64b702c00b94d744224640def49877ddc6633637eb898d035076568bd91f0f753b1b928455d5ed1ad8e2ecbad1432e46e3c2b8fa3be8e920e1cb3026f701baa9c586be0ed776ba28dd601c3cc0c39f632d53fc36de5081e6b8880a59b6dca06a5619c78a663f25dc141b280ac9c5a084c0bb8f8632217b5d4644de0cd4610905d39dd8372ea2c5215ad645fe5744f1e61fae0acef16536fc2a21845855bec29c0c47f3acf7184cd579113199bad5e93660c93bba5bf7da6a2a65108418097c31a6b52935c5af4d2e94a56b5bfea65350c74e4310ca0be4264dc601464bf0635cb2bab9109e4975646560753a8ed98a0777dcbb63acbe8a941f6f402489f56f3f9c81ea73ae5ad262de2cb49eb4a287684f134cb74f8d0311ffc45c48e0000400beacf00e78471e97be31d5236c0e290c35d15d82529590f85add6870e965725e2fc53c0ea72542b2cae2b3dc36acc683925f18d87b2bdc000f7cefaa9243367f67ebf5a45eeaa8c0cfb0e3e94e7897fc43841329e422fcbb2f661644e364eec4f96d446524b009d75f3bc403fd617194ffeaaf770122eda9917db5a7e5bdf64213fcdce1881ff2c97e2deb8d894e6e59d43a2aa5a02d386a9f0dcb8036a1948c4993c0f3c144213368227133574429af757593d0bc8cfbd1b18e003394d4fd56c49cc2b42148ac5d5a399317bdb2360c22e8a80c130d1952a6a39699b328ba05d2a2f96aafb85b22a088c66954a6bfe4bb5394e0c4de375d573b456e7deb248a86bb16a604e08cc88605146db0f5c109acd723fdd8ad99fe574ad611d14d52e67a04a0cb28577cb26c2509bbcd248afb1f4e6ec81e6645f4d5b19d09371b6ad9522528004707c15d07b5bf213770607df593478099622e60ab5154b62db617a89afed9eaf7cc79d1971fc79526e132b440f2eee0070ba4e81492aabdae081776144645af536ef05971526ff2310c829f4d496824bc8dfa24349b086c1811d12c62362b0f275dc1e472bb826ba1b2cd2dcc20196141c7a3b8790af1c2cae165e21864eee4fda4b47006b719bcf40696208265103f5780a5fd6621b083f85356565c774f75fcac54adb6d422bd8483d2e614db246f835e1161c5b1ee70075dfe1cfd2b120d273f757ad34e8b97d008fdaf38c797faece05e13621a9950462d2a5a34d53d7fb6d788f45b5399f8bcce55029ef8b91f5448426c73aff97ccaf2edc62f7012ac4626349fd2135c29f902cc584843ac0dd9e5bf2754a5e38c398702a9607daacb3320b9f0be199b8dbb7e668f643d0fb8d5bab8e3e661a543f3904e6dd8af1ddd43708ef305ab4e1f0ae88f9c16dc29187d89f7bccde9e4ef92da3fbfe76404aa97f492e3fe70ee55e31b04b19956d6ef356d29f5479c1473bfaa648028dbf72cafa9b10dda32b944b433e29c539e708b2f57b1a810943934106597b7e5007900aeb9f1799ce31d47c62b88460b4a5d84ba9157d54b0479405e07f96dc33d7be263e632b9e2afa5d95cd34cd01984740c09709b462d817e2e3b30e100b49889cdff48491919b14a863bb416dba48301196612093ddd376f70afd030562ee092740e7d63e5710bd73b707e6e92443f5ce7d12d9150e93435c1296f73a3edf62beea4859b9ecb195311498997edfb69bef0b9f60958e22d7576397f7f7b687b38a543c335c677eea154e21b3ee30d501bdd22b274955ef28a52dfec753ff9faf66042d0efbe229058dc500b673c70db4dc2631c6542874bf1c4f951bc1f9bc4fa5678e76b237b9802b75f1f58dc0dfe227f709bbb37e0386cd0b358ef5a7cac84fa6833e448650852aa3452f54147a67a2fc692e556096fef1d94535380b7ee580803e02cf58d030041da45f00e8031154c13a841d24b4f28ba1044640327eaed09120d163bdbe272a65e3e50e70f52a95962561584d09721fda3b0f3c6c9b1d334f08a41adccd96d8b3c46808cf388d2b48375ff8ddde137ec0f22cd5413f409ea034430fcdabbb1a44097ba23f1521af66750384250e1f50ddc311d4c12a4a65040eb38af51d01aabd4c55ee1bc7d6ad115736b8456be21e10a830a244f36f3d14d00d688253439c86f4e43814b758e0254d78e1b33fe28ecf0d2476a90dac26d9bc9fff0adc0465bfef01bc46276d4ec2ced963904dedf411b2061c05569955987c7bb5ea0a59eb359bdb00abfb88101b6d576b275fa44b559ec0f8abb96b470918972d4814564509943b6cdf2b759ac0875ea9c1725a947b62797d55de4b4cbc2745a41e4940a8c2af96c0207fb27b02f7ee9a5f20f97a30956d1cf1191dbb8a56f3ac84ade963b7ccd0103b0f43598a67891c2cec8342f42ae2f594d7024774c80ae137d17d76ef5e3c83cdf43d4a6811eca16f2c86dbb522bc42e606301248554ae7013a8309cde8bf336404248c92b3a296807b3473cbdd257fc5e4effa78c8898ceec635be22e5c0537e85efe48bfe10cb7a470da590cc0a606f4566c0819b51d96bf34bfe24f078bab3c524a437bf8f74077389aff4726253791b2c584f238946d7b3c8e12a237f727a4afae74aa3c08bc911c6b9333db41e0fe3f7bca2ea1f9ab51fc18d370be4ba16cc9142edcb300b7b5703873847e59e45a50995950b73be56834837ef4541313119d705c0bf29791fa25bfa155845ad7d9381dda354571bc6539b2e172ff442419fdd9834d88b109e60aae3bdaadc0208f32aeb470b00e480813242db0066345e1bc4bb27c7e81704e5b387fa7c5f4b2c3ecbf86d7dea22413488d56f550eb6c857d93431ed2d53aaabdec7a6021b96f7bd5e68bb2ccf16306d8befa62dc724ff4d8e1d69520e1d1f9b8dc998bad11c5b91a6cc6280cadb713aeb4d5fbc3fffb184265d9d8d3981e10b9727d803ece05e7ef050b5360d077ac1de661b665ea6e6bb75974923bbf8d5ac3b8942b9242611715dc550709dea9b0a78a6f5607406206a701fc56c2e218d8b70bd166a86dcaee48767c93897f53747ecf884b5cc1ac37754379ef6b778720c41ae45bb82d211bb86422b929a4f0cae5a5b0c70e79f099b6e1acdccf5ebac4f751fdeca5812a0c7ebf17ee3ee8e12ca4b2b521b1feba5e362f5e84e524f92000e1529373d6c7072767e808b8e9fb1e6182942929fa6b1b3bbf201030f2d545f6095a0a8bc28393f4a59677f8093a4add9ebf1050f1d23598fa5b5cbf8fa000000000000000000000000000000000000000000000000000000000000000000111b26343f020aa698140026043023c316811074010002080504a0501024884900a4220900c29155b1f9930c0300010204060901"

	if hex.EncodeToString(signatureMessage) != expectedSigMsg {
		t.Error("SignatureMessage mismatch")
	}
}

func TestDilithium_Open(t *testing.T) {
	pk := PKHStrToBin(PK1)
	sk := SKHStrToBin(SK1)
	msg := []uint8{0, 1, 2, 4, 6, 9, 1}
	d := NewFromKeys(&pk, &sk)
	signatureMessage := d.Seal(msg)

	expectedSigMsg := "8c7c0ffc1dfd5b7de11e9c21c6274855bee171fc5022a70eb60da13ef1389f10ab435f06f39f46099802ac8aafaec59396ddcfd75f7e4cbdab72679b82d2e4e12584513b8c1f62cd4cd4b769debb9a47be2979a1f92c2f5b85827bd1495179bf1150bc773e670880c9183fe4123661dd18e413d53db17fb012a0d2db35ec73e1e8210f65960bbf00a599216f5ef60e7a0ce9b19e020803edeec074254a7a4c46591eeee6e6b13ea129493695987cfdea5e2c7b5ee3343bba46590178f74ad54375ff67b6b0541e6a94c378deb4a670413a1920810ada665047709ad4c95261c6aff1920945a9107d7c5cd243166e6f8a5cea8d3aa4ab75eae6a70e78d89342861f170b40d4af8ff0e283c2a631763a8ccc5870cac7e449f2a0bb4470520671ee35b061e8fb704fb341f9deb0edc7a3c912611c8c51a8180835251574b351e5bc2baa28f0c1904e764c5b880c421bcb22ce92d178e1aa5124ad78962c230b7d6ab78c02ef3a4365f64b702c00b94d744224640def49877ddc6633637eb898d035076568bd91f0f753b1b928455d5ed1ad8e2ecbad1432e46e3c2b8fa3be8e920e1cb3026f701baa9c586be0ed776ba28dd601c3cc0c39f632d53fc36de5081e6b8880a59b6dca06a5619c78a663f25dc141b280ac9c5a084c0bb8f8632217b5d4644de0cd4610905d39dd8372ea2c5215ad645fe5744f1e61fae0acef16536fc2a21845855bec29c0c47f3acf7184cd579113199bad5e93660c93bba5bf7da6a2a65108418097c31a6b52935c5af4d2e94a56b5bfea65350c74e4310ca0be4264dc601464bf0635cb2bab9109e4975646560753a8ed98a0777dcbb63acbe8a941f6f402489f56f3f9c81ea73ae5ad262de2cb49eb4a287684f134cb74f8d0311ffc45c48e0000400beacf00e78471e97be31d5236c0e290c35d15d82529590f85add6870e965725e2fc53c0ea72542b2cae2b3dc36acc683925f18d87b2bdc000f7cefaa9243367f67ebf5a45eeaa8c0cfb0e3e94e7897fc43841329e422fcbb2f661644e364eec4f96d446524b009d75f3bc403fd617194ffeaaf770122eda9917db5a7e5bdf64213fcdce1881ff2c97e2deb8d894e6e59d43a2aa5a02d386a9f0dcb8036a1948c4993c0f3c144213368227133574429af757593d0bc8cfbd1b18e003394d4fd56c49cc2b42148ac5d5a399317bdb2360c22e8a80c130d1952a6a39699b328ba05d2a2f96aafb85b22a088c66954a6bfe4bb5394e0c4de375d573b456e7deb248a86bb16a604e08cc88605146db0f5c109acd723fdd8ad99fe574ad611d14d52e67a04a0cb28577cb26c2509bbcd248afb1f4e6ec81e6645f4d5b19d09371b6ad9522528004707c15d07b5bf213770607df593478099622e60ab5154b62db617a89afed9eaf7cc79d1971fc79526e132b440f2eee0070ba4e81492aabdae081776144645af536ef05971526ff2310c829f4d496824bc8dfa24349b086c1811d12c62362b0f275dc1e472bb826ba1b2cd2dcc20196141c7a3b8790af1c2cae165e21864eee4fda4b47006b719bcf40696208265103f5780a5fd6621b083f85356565c774f75fcac54adb6d422bd8483d2e614db246f835e1161c5b1ee70075dfe1cfd2b120d273f757ad34e8b97d008fdaf38c797faece05e13621a9950462d2a5a34d53d7fb6d788f45b5399f8bcce55029ef8b91f5448426c73aff97ccaf2edc62f7012ac4626349fd2135c29f902cc584843ac0dd9e5bf2754a5e38c398702a9607daacb3320b9f0be199b8dbb7e668f643d0fb8d5bab8e3e661a543f3904e6dd8af1ddd43708ef305ab4e1f0ae88f9c16dc29187d89f7bccde9e4ef92da3fbfe76404aa97f492e3fe70ee55e31b04b19956d6ef356d29f5479c1473bfaa648028dbf72cafa9b10dda32b944b433e29c539e708b2f57b1a810943934106597b7e5007900aeb9f1799ce31d47c62b88460b4a5d84ba9157d54b0479405e07f96dc33d7be263e632b9e2afa5d95cd34cd01984740c09709b462d817e2e3b30e100b49889cdff48491919b14a863bb416dba48301196612093ddd376f70afd030562ee092740e7d63e5710bd73b707e6e92443f5ce7d12d9150e93435c1296f73a3edf62beea4859b9ecb195311498997edfb69bef0b9f60958e22d7576397f7f7b687b38a543c335c677eea154e21b3ee30d501bdd22b274955ef28a52dfec753ff9faf66042d0efbe229058dc500b673c70db4dc2631c6542874bf1c4f951bc1f9bc4fa5678e76b237b9802b75f1f58dc0dfe227f709bbb37e0386cd0b358ef5a7cac84fa6833e448650852aa3452f54147a67a2fc692e556096fef1d94535380b7ee580803e02cf58d030041da45f00e8031154c13a841d24b4f28ba1044640327eaed09120d163bdbe272a65e3e50e70f52a95962561584d09721fda3b0f3c6c9b1d334f08a41adccd96d8b3c46808cf388d2b48375ff8ddde137ec0f22cd5413f409ea034430fcdabbb1a44097ba23f1521af66750384250e1f50ddc311d4c12a4a65040eb38af51d01aabd4c55ee1bc7d6ad115736b8456be21e10a830a244f36f3d14d00d688253439c86f4e43814b758e0254d78e1b33fe28ecf0d2476a90dac26d9bc9fff0adc0465bfef01bc46276d4ec2ced963904dedf411b2061c05569955987c7bb5ea0a59eb359bdb00abfb88101b6d576b275fa44b559ec0f8abb96b470918972d4814564509943b6cdf2b759ac0875ea9c1725a947b62797d55de4b4cbc2745a41e4940a8c2af96c0207fb27b02f7ee9a5f20f97a30956d1cf1191dbb8a56f3ac84ade963b7ccd0103b0f43598a67891c2cec8342f42ae2f594d7024774c80ae137d17d76ef5e3c83cdf43d4a6811eca16f2c86dbb522bc42e606301248554ae7013a8309cde8bf336404248c92b3a296807b3473cbdd257fc5e4effa78c8898ceec635be22e5c0537e85efe48bfe10cb7a470da590cc0a606f4566c0819b51d96bf34bfe24f078bab3c524a437bf8f74077389aff4726253791b2c584f238946d7b3c8e12a237f727a4afae74aa3c08bc911c6b9333db41e0fe3f7bca2ea1f9ab51fc18d370be4ba16cc9142edcb300b7b5703873847e59e45a50995950b73be56834837ef4541313119d705c0bf29791fa25bfa155845ad7d9381dda354571bc6539b2e172ff442419fdd9834d88b109e60aae3bdaadc0208f32aeb470b00e480813242db0066345e1bc4bb27c7e81704e5b387fa7c5f4b2c3ecbf86d7dea22413488d56f550eb6c857d93431ed2d53aaabdec7a6021b96f7bd5e68bb2ccf16306d8befa62dc724ff4d8e1d69520e1d1f9b8dc998bad11c5b91a6cc6280cadb713aeb4d5fbc3fffb184265d9d8d3981e10b9727d803ece05e7ef050b5360d077ac1de661b665ea6e6bb75974923bbf8d5ac3b8942b9242611715dc550709dea9b0a78a6f5607406206a701fc56c2e218d8b70bd166a86dcaee48767c93897f53747ecf884b5cc1ac37754379ef6b778720c41ae45bb82d211bb86422b929a4f0cae5a5b0c70e79f099b6e1acdccf5ebac4f751fdeca5812a0c7ebf17ee3ee8e12ca4b2b521b1feba5e362f5e84e524f92000e1529373d6c7072767e808b8e9fb1e6182942929fa6b1b3bbf201030f2d545f6095a0a8bc28393f4a59677f8093a4add9ebf1050f1d23598fa5b5cbf8fa000000000000000000000000000000000000000000000000000000000000000000111b26343f020aa698140026043023c316811074010002080504a0501024884900a4220900c29155b1f9930c0300010204060901"

	if hex.EncodeToString(signatureMessage) != expectedSigMsg {
		t.Error("SignatureMessage mismatch")
	}

	pk = d.GetPK()
	if !reflect.DeepEqual(Open(signatureMessage, &pk), msg) {
		t.Error("SignatureMessage Verification failed")
	}
}

func TestDilithium_Sign(t *testing.T) {
	pk := PKHStrToBin(PK1)
	sk := SKHStrToBin(SK1)
	msg := []uint8{0, 1, 2, 4, 6, 9, 1}
	d := NewFromKeys(&pk, &sk)
	signature := d.Sign(msg)
	expectedSig := "8c7c0ffc1dfd5b7de11e9c21c6274855bee171fc5022a70eb60da13ef1389f10ab435f06f39f46099802ac8aafaec59396ddcfd75f7e4cbdab72679b82d2e4e12584513b8c1f62cd4cd4b769debb9a47be2979a1f92c2f5b85827bd1495179bf1150bc773e670880c9183fe4123661dd18e413d53db17fb012a0d2db35ec73e1e8210f65960bbf00a599216f5ef60e7a0ce9b19e020803edeec074254a7a4c46591eeee6e6b13ea129493695987cfdea5e2c7b5ee3343bba46590178f74ad54375ff67b6b0541e6a94c378deb4a670413a1920810ada665047709ad4c95261c6aff1920945a9107d7c5cd243166e6f8a5cea8d3aa4ab75eae6a70e78d89342861f170b40d4af8ff0e283c2a631763a8ccc5870cac7e449f2a0bb4470520671ee35b061e8fb704fb341f9deb0edc7a3c912611c8c51a8180835251574b351e5bc2baa28f0c1904e764c5b880c421bcb22ce92d178e1aa5124ad78962c230b7d6ab78c02ef3a4365f64b702c00b94d744224640def49877ddc6633637eb898d035076568bd91f0f753b1b928455d5ed1ad8e2ecbad1432e46e3c2b8fa3be8e920e1cb3026f701baa9c586be0ed776ba28dd601c3cc0c39f632d53fc36de5081e6b8880a59b6dca06a5619c78a663f25dc141b280ac9c5a084c0bb8f8632217b5d4644de0cd4610905d39dd8372ea2c5215ad645fe5744f1e61fae0acef16536fc2a21845855bec29c0c47f3acf7184cd579113199bad5e93660c93bba5bf7da6a2a65108418097c31a6b52935c5af4d2e94a56b5bfea65350c74e4310ca0be4264dc601464bf0635cb2bab9109e4975646560753a8ed98a0777dcbb63acbe8a941f6f402489f56f3f9c81ea73ae5ad262de2cb49eb4a287684f134cb74f8d0311ffc45c48e0000400beacf00e78471e97be31d5236c0e290c35d15d82529590f85add6870e965725e2fc53c0ea72542b2cae2b3dc36acc683925f18d87b2bdc000f7cefaa9243367f67ebf5a45eeaa8c0cfb0e3e94e7897fc43841329e422fcbb2f661644e364eec4f96d446524b009d75f3bc403fd617194ffeaaf770122eda9917db5a7e5bdf64213fcdce1881ff2c97e2deb8d894e6e59d43a2aa5a02d386a9f0dcb8036a1948c4993c0f3c144213368227133574429af757593d0bc8cfbd1b18e003394d4fd56c49cc2b42148ac5d5a399317bdb2360c22e8a80c130d1952a6a39699b328ba05d2a2f96aafb85b22a088c66954a6bfe4bb5394e0c4de375d573b456e7deb248a86bb16a604e08cc88605146db0f5c109acd723fdd8ad99fe574ad611d14d52e67a04a0cb28577cb26c2509bbcd248afb1f4e6ec81e6645f4d5b19d09371b6ad9522528004707c15d07b5bf213770607df593478099622e60ab5154b62db617a89afed9eaf7cc79d1971fc79526e132b440f2eee0070ba4e81492aabdae081776144645af536ef05971526ff2310c829f4d496824bc8dfa24349b086c1811d12c62362b0f275dc1e472bb826ba1b2cd2dcc20196141c7a3b8790af1c2cae165e21864eee4fda4b47006b719bcf40696208265103f5780a5fd6621b083f85356565c774f75fcac54adb6d422bd8483d2e614db246f835e1161c5b1ee70075dfe1cfd2b120d273f757ad34e8b97d008fdaf38c797faece05e13621a9950462d2a5a34d53d7fb6d788f45b5399f8bcce55029ef8b91f5448426c73aff97ccaf2edc62f7012ac4626349fd2135c29f902cc584843ac0dd9e5bf2754a5e38c398702a9607daacb3320b9f0be199b8dbb7e668f643d0fb8d5bab8e3e661a543f3904e6dd8af1ddd43708ef305ab4e1f0ae88f9c16dc29187d89f7bccde9e4ef92da3fbfe76404aa97f492e3fe70ee55e31b04b19956d6ef356d29f5479c1473bfaa648028dbf72cafa9b10dda32b944b433e29c539e708b2f57b1a810943934106597b7e5007900aeb9f1799ce31d47c62b88460b4a5d84ba9157d54b0479405e07f96dc33d7be263e632b9e2afa5d95cd34cd01984740c09709b462d817e2e3b30e100b49889cdff48491919b14a863bb416dba48301196612093ddd376f70afd030562ee092740e7d63e5710bd73b707e6e92443f5ce7d12d9150e93435c1296f73a3edf62beea4859b9ecb195311498997edfb69bef0b9f60958e22d7576397f7f7b687b38a543c335c677eea154e21b3ee30d501bdd22b274955ef28a52dfec753ff9faf66042d0efbe229058dc500b673c70db4dc2631c6542874bf1c4f951bc1f9bc4fa5678e76b237b9802b75f1f58dc0dfe227f709bbb37e0386cd0b358ef5a7cac84fa6833e448650852aa3452f54147a67a2fc692e556096fef1d94535380b7ee580803e02cf58d030041da45f00e8031154c13a841d24b4f28ba1044640327eaed09120d163bdbe272a65e3e50e70f52a95962561584d09721fda3b0f3c6c9b1d334f08a41adccd96d8b3c46808cf388d2b48375ff8ddde137ec0f22cd5413f409ea034430fcdabbb1a44097ba23f1521af66750384250e1f50ddc311d4c12a4a65040eb38af51d01aabd4c55ee1bc7d6ad115736b8456be21e10a830a244f36f3d14d00d688253439c86f4e43814b758e0254d78e1b33fe28ecf0d2476a90dac26d9bc9fff0adc0465bfef01bc46276d4ec2ced963904dedf411b2061c05569955987c7bb5ea0a59eb359bdb00abfb88101b6d576b275fa44b559ec0f8abb96b470918972d4814564509943b6cdf2b759ac0875ea9c1725a947b62797d55de4b4cbc2745a41e4940a8c2af96c0207fb27b02f7ee9a5f20f97a30956d1cf1191dbb8a56f3ac84ade963b7ccd0103b0f43598a67891c2cec8342f42ae2f594d7024774c80ae137d17d76ef5e3c83cdf43d4a6811eca16f2c86dbb522bc42e606301248554ae7013a8309cde8bf336404248c92b3a296807b3473cbdd257fc5e4effa78c8898ceec635be22e5c0537e85efe48bfe10cb7a470da590cc0a606f4566c0819b51d96bf34bfe24f078bab3c524a437bf8f74077389aff4726253791b2c584f238946d7b3c8e12a237f727a4afae74aa3c08bc911c6b9333db41e0fe3f7bca2ea1f9ab51fc18d370be4ba16cc9142edcb300b7b5703873847e59e45a50995950b73be56834837ef4541313119d705c0bf29791fa25bfa155845ad7d9381dda354571bc6539b2e172ff442419fdd9834d88b109e60aae3bdaadc0208f32aeb470b00e480813242db0066345e1bc4bb27c7e81704e5b387fa7c5f4b2c3ecbf86d7dea22413488d56f550eb6c857d93431ed2d53aaabdec7a6021b96f7bd5e68bb2ccf16306d8befa62dc724ff4d8e1d69520e1d1f9b8dc998bad11c5b91a6cc6280cadb713aeb4d5fbc3fffb184265d9d8d3981e10b9727d803ece05e7ef050b5360d077ac1de661b665ea6e6bb75974923bbf8d5ac3b8942b9242611715dc550709dea9b0a78a6f5607406206a701fc56c2e218d8b70bd166a86dcaee48767c93897f53747ecf884b5cc1ac37754379ef6b778720c41ae45bb82d211bb86422b929a4f0cae5a5b0c70e79f099b6e1acdccf5ebac4f751fdeca5812a0c7ebf17ee3ee8e12ca4b2b521b1feba5e362f5e84e524f92111b26343f000e1529373d6c7072767e808b8e9fb1e6182942929fa6b1b3bbf201030f2d545f6095a0a8bc28393f4a59677f8093a4add9ebf1050f1d23598fa5b5cbf8fa020aa698140026043023c316811074010002080504a0501024884900a4220900c29155b1f9930c03"

	if hex.EncodeToString(signature) != expectedSig {
		t.Error("Signature mismatch")
	}
}

func TestDilithium_Verify(t *testing.T) {
	pk := PKHStrToBin(PK1)
	sk := SKHStrToBin(SK1)
	msg := []uint8{0, 1, 2, 4, 6, 9, 1}
	d := NewFromKeys(&pk, &sk)
	signature := d.Sign(msg)
	expectedSig := "8c7c0ffc1dfd5b7de11e9c21c6274855bee171fc5022a70eb60da13ef1389f10ab435f06f39f46099802ac8aafaec59396ddcfd75f7e4cbdab72679b82d2e4e12584513b8c1f62cd4cd4b769debb9a47be2979a1f92c2f5b85827bd1495179bf1150bc773e670880c9183fe4123661dd18e413d53db17fb012a0d2db35ec73e1e8210f65960bbf00a599216f5ef60e7a0ce9b19e020803edeec074254a7a4c46591eeee6e6b13ea129493695987cfdea5e2c7b5ee3343bba46590178f74ad54375ff67b6b0541e6a94c378deb4a670413a1920810ada665047709ad4c95261c6aff1920945a9107d7c5cd243166e6f8a5cea8d3aa4ab75eae6a70e78d89342861f170b40d4af8ff0e283c2a631763a8ccc5870cac7e449f2a0bb4470520671ee35b061e8fb704fb341f9deb0edc7a3c912611c8c51a8180835251574b351e5bc2baa28f0c1904e764c5b880c421bcb22ce92d178e1aa5124ad78962c230b7d6ab78c02ef3a4365f64b702c00b94d744224640def49877ddc6633637eb898d035076568bd91f0f753b1b928455d5ed1ad8e2ecbad1432e46e3c2b8fa3be8e920e1cb3026f701baa9c586be0ed776ba28dd601c3cc0c39f632d53fc36de5081e6b8880a59b6dca06a5619c78a663f25dc141b280ac9c5a084c0bb8f8632217b5d4644de0cd4610905d39dd8372ea2c5215ad645fe5744f1e61fae0acef16536fc2a21845855bec29c0c47f3acf7184cd579113199bad5e93660c93bba5bf7da6a2a65108418097c31a6b52935c5af4d2e94a56b5bfea65350c74e4310ca0be4264dc601464bf0635cb2bab9109e4975646560753a8ed98a0777dcbb63acbe8a941f6f402489f56f3f9c81ea73ae5ad262de2cb49eb4a287684f134cb74f8d0311ffc45c48e0000400beacf00e78471e97be31d5236c0e290c35d15d82529590f85add6870e965725e2fc53c0ea72542b2cae2b3dc36acc683925f18d87b2bdc000f7cefaa9243367f67ebf5a45eeaa8c0cfb0e3e94e7897fc43841329e422fcbb2f661644e364eec4f96d446524b009d75f3bc403fd617194ffeaaf770122eda9917db5a7e5bdf64213fcdce1881ff2c97e2deb8d894e6e59d43a2aa5a02d386a9f0dcb8036a1948c4993c0f3c144213368227133574429af757593d0bc8cfbd1b18e003394d4fd56c49cc2b42148ac5d5a399317bdb2360c22e8a80c130d1952a6a39699b328ba05d2a2f96aafb85b22a088c66954a6bfe4bb5394e0c4de375d573b456e7deb248a86bb16a604e08cc88605146db0f5c109acd723fdd8ad99fe574ad611d14d52e67a04a0cb28577cb26c2509bbcd248afb1f4e6ec81e6645f4d5b19d09371b6ad9522528004707c15d07b5bf213770607df593478099622e60ab5154b62db617a89afed9eaf7cc79d1971fc79526e132b440f2eee0070ba4e81492aabdae081776144645af536ef05971526ff2310c829f4d496824bc8dfa24349b086c1811d12c62362b0f275dc1e472bb826ba1b2cd2dcc20196141c7a3b8790af1c2cae165e21864eee4fda4b47006b719bcf40696208265103f5780a5fd6621b083f85356565c774f75fcac54adb6d422bd8483d2e614db246f835e1161c5b1ee70075dfe1cfd2b120d273f757ad34e8b97d008fdaf38c797faece05e13621a9950462d2a5a34d53d7fb6d788f45b5399f8bcce55029ef8b91f5448426c73aff97ccaf2edc62f7012ac4626349fd2135c29f902cc584843ac0dd9e5bf2754a5e38c398702a9607daacb3320b9f0be199b8dbb7e668f643d0fb8d5bab8e3e661a543f3904e6dd8af1ddd43708ef305ab4e1f0ae88f9c16dc29187d89f7bccde9e4ef92da3fbfe76404aa97f492e3fe70ee55e31b04b19956d6ef356d29f5479c1473bfaa648028dbf72cafa9b10dda32b944b433e29c539e708b2f57b1a810943934106597b7e5007900aeb9f1799ce31d47c62b88460b4a5d84ba9157d54b0479405e07f96dc33d7be263e632b9e2afa5d95cd34cd01984740c09709b462d817e2e3b30e100b49889cdff48491919b14a863bb416dba48301196612093ddd376f70afd030562ee092740e7d63e5710bd73b707e6e92443f5ce7d12d9150e93435c1296f73a3edf62beea4859b9ecb195311498997edfb69bef0b9f60958e22d7576397f7f7b687b38a543c335c677eea154e21b3ee30d501bdd22b274955ef28a52dfec753ff9faf66042d0efbe229058dc500b673c70db4dc2631c6542874bf1c4f951bc1f9bc4fa5678e76b237b9802b75f1f58dc0dfe227f709bbb37e0386cd0b358ef5a7cac84fa6833e448650852aa3452f54147a67a2fc692e556096fef1d94535380b7ee580803e02cf58d030041da45f00e8031154c13a841d24b4f28ba1044640327eaed09120d163bdbe272a65e3e50e70f52a95962561584d09721fda3b0f3c6c9b1d334f08a41adccd96d8b3c46808cf388d2b48375ff8ddde137ec0f22cd5413f409ea034430fcdabbb1a44097ba23f1521af66750384250e1f50ddc311d4c12a4a65040eb38af51d01aabd4c55ee1bc7d6ad115736b8456be21e10a830a244f36f3d14d00d688253439c86f4e43814b758e0254d78e1b33fe28ecf0d2476a90dac26d9bc9fff0adc0465bfef01bc46276d4ec2ced963904dedf411b2061c05569955987c7bb5ea0a59eb359bdb00abfb88101b6d576b275fa44b559ec0f8abb96b470918972d4814564509943b6cdf2b759ac0875ea9c1725a947b62797d55de4b4cbc2745a41e4940a8c2af96c0207fb27b02f7ee9a5f20f97a30956d1cf1191dbb8a56f3ac84ade963b7ccd0103b0f43598a67891c2cec8342f42ae2f594d7024774c80ae137d17d76ef5e3c83cdf43d4a6811eca16f2c86dbb522bc42e606301248554ae7013a8309cde8bf336404248c92b3a296807b3473cbdd257fc5e4effa78c8898ceec635be22e5c0537e85efe48bfe10cb7a470da590cc0a606f4566c0819b51d96bf34bfe24f078bab3c524a437bf8f74077389aff4726253791b2c584f238946d7b3c8e12a237f727a4afae74aa3c08bc911c6b9333db41e0fe3f7bca2ea1f9ab51fc18d370be4ba16cc9142edcb300b7b5703873847e59e45a50995950b73be56834837ef4541313119d705c0bf29791fa25bfa155845ad7d9381dda354571bc6539b2e172ff442419fdd9834d88b109e60aae3bdaadc0208f32aeb470b00e480813242db0066345e1bc4bb27c7e81704e5b387fa7c5f4b2c3ecbf86d7dea22413488d56f550eb6c857d93431ed2d53aaabdec7a6021b96f7bd5e68bb2ccf16306d8befa62dc724ff4d8e1d69520e1d1f9b8dc998bad11c5b91a6cc6280cadb713aeb4d5fbc3fffb184265d9d8d3981e10b9727d803ece05e7ef050b5360d077ac1de661b665ea6e6bb75974923bbf8d5ac3b8942b9242611715dc550709dea9b0a78a6f5607406206a701fc56c2e218d8b70bd166a86dcaee48767c93897f53747ecf884b5cc1ac37754379ef6b778720c41ae45bb82d211bb86422b929a4f0cae5a5b0c70e79f099b6e1acdccf5ebac4f751fdeca5812a0c7ebf17ee3ee8e12ca4b2b521b1feba5e362f5e84e524f92111b26343f000e1529373d6c7072767e808b8e9fb1e6182942929fa6b1b3bbf201030f2d545f6095a0a8bc28393f4a59677f8093a4add9ebf1050f1d23598fa5b5cbf8fa020aa698140026043023c316811074010002080504a0501024884900a4220900c29155b1f9930c03"

	if hex.EncodeToString(signature) != expectedSig {
		t.Error("Signature mismatch")
	}

	pk = d.GetPK()
	if !Verify(msg, signature, &pk) {
		t.Error("Signature Verification failed")
	}
}

func TestExtractMessage(t *testing.T) {
	pk := PKHStrToBin(PK1)
	sk := SKHStrToBin(SK1)
	msg := []uint8{0, 1, 2, 4, 6, 9, 1}
	d := NewFromKeys(&pk, &sk)
	signatureMessage := d.Seal(msg)

	expectedSigMsg := "8c7c0ffc1dfd5b7de11e9c21c6274855bee171fc5022a70eb60da13ef1389f10ab435f06f39f46099802ac8aafaec59396ddcfd75f7e4cbdab72679b82d2e4e12584513b8c1f62cd4cd4b769debb9a47be2979a1f92c2f5b85827bd1495179bf1150bc773e670880c9183fe4123661dd18e413d53db17fb012a0d2db35ec73e1e8210f65960bbf00a599216f5ef60e7a0ce9b19e020803edeec074254a7a4c46591eeee6e6b13ea129493695987cfdea5e2c7b5ee3343bba46590178f74ad54375ff67b6b0541e6a94c378deb4a670413a1920810ada665047709ad4c95261c6aff1920945a9107d7c5cd243166e6f8a5cea8d3aa4ab75eae6a70e78d89342861f170b40d4af8ff0e283c2a631763a8ccc5870cac7e449f2a0bb4470520671ee35b061e8fb704fb341f9deb0edc7a3c912611c8c51a8180835251574b351e5bc2baa28f0c1904e764c5b880c421bcb22ce92d178e1aa5124ad78962c230b7d6ab78c02ef3a4365f64b702c00b94d744224640def49877ddc6633637eb898d035076568bd91f0f753b1b928455d5ed1ad8e2ecbad1432e46e3c2b8fa3be8e920e1cb3026f701baa9c586be0ed776ba28dd601c3cc0c39f632d53fc36de5081e6b8880a59b6dca06a5619c78a663f25dc141b280ac9c5a084c0bb8f8632217b5d4644de0cd4610905d39dd8372ea2c5215ad645fe5744f1e61fae0acef16536fc2a21845855bec29c0c47f3acf7184cd579113199bad5e93660c93bba5bf7da6a2a65108418097c31a6b52935c5af4d2e94a56b5bfea65350c74e4310ca0be4264dc601464bf0635cb2bab9109e4975646560753a8ed98a0777dcbb63acbe8a941f6f402489f56f3f9c81ea73ae5ad262de2cb49eb4a287684f134cb74f8d0311ffc45c48e0000400beacf00e78471e97be31d5236c0e290c35d15d82529590f85add6870e965725e2fc53c0ea72542b2cae2b3dc36acc683925f18d87b2bdc000f7cefaa9243367f67ebf5a45eeaa8c0cfb0e3e94e7897fc43841329e422fcbb2f661644e364eec4f96d446524b009d75f3bc403fd617194ffeaaf770122eda9917db5a7e5bdf64213fcdce1881ff2c97e2deb8d894e6e59d43a2aa5a02d386a9f0dcb8036a1948c4993c0f3c144213368227133574429af757593d0bc8cfbd1b18e003394d4fd56c49cc2b42148ac5d5a399317bdb2360c22e8a80c130d1952a6a39699b328ba05d2a2f96aafb85b22a088c66954a6bfe4bb5394e0c4de375d573b456e7deb248a86bb16a604e08cc88605146db0f5c109acd723fdd8ad99fe574ad611d14d52e67a04a0cb28577cb26c2509bbcd248afb1f4e6ec81e6645f4d5b19d09371b6ad9522528004707c15d07b5bf213770607df593478099622e60ab5154b62db617a89afed9eaf7cc79d1971fc79526e132b440f2eee0070ba4e81492aabdae081776144645af536ef05971526ff2310c829f4d496824bc8dfa24349b086c1811d12c62362b0f275dc1e472bb826ba1b2cd2dcc20196141c7a3b8790af1c2cae165e21864eee4fda4b47006b719bcf40696208265103f5780a5fd6621b083f85356565c774f75fcac54adb6d422bd8483d2e614db246f835e1161c5b1ee70075dfe1cfd2b120d273f757ad34e8b97d008fdaf38c797faece05e13621a9950462d2a5a34d53d7fb6d788f45b5399f8bcce55029ef8b91f5448426c73aff97ccaf2edc62f7012ac4626349fd2135c29f902cc584843ac0dd9e5bf2754a5e38c398702a9607daacb3320b9f0be199b8dbb7e668f643d0fb8d5bab8e3e661a543f3904e6dd8af1ddd43708ef305ab4e1f0ae88f9c16dc29187d89f7bccde9e4ef92da3fbfe76404aa97f492e3fe70ee55e31b04b19956d6ef356d29f5479c1473bfaa648028dbf72cafa9b10dda32b944b433e29c539e708b2f57b1a810943934106597b7e5007900aeb9f1799ce31d47c62b88460b4a5d84ba9157d54b0479405e07f96dc33d7be263e632b9e2afa5d95cd34cd01984740c09709b462d817e2e3b30e100b49889cdff48491919b14a863bb416dba48301196612093ddd376f70afd030562ee092740e7d63e5710bd73b707e6e92443f5ce7d12d9150e93435c1296f73a3edf62beea4859b9ecb195311498997edfb69bef0b9f60958e22d7576397f7f7b687b38a543c335c677eea154e21b3ee30d501bdd22b274955ef28a52dfec753ff9faf66042d0efbe229058dc500b673c70db4dc2631c6542874bf1c4f951bc1f9bc4fa5678e76b237b9802b75f1f58dc0dfe227f709bbb37e0386cd0b358ef5a7cac84fa6833e448650852aa3452f54147a67a2fc692e556096fef1d94535380b7ee580803e02cf58d030041da45f00e8031154c13a841d24b4f28ba1044640327eaed09120d163bdbe272a65e3e50e70f52a95962561584d09721fda3b0f3c6c9b1d334f08a41adccd96d8b3c46808cf388d2b48375ff8ddde137ec0f22cd5413f409ea034430fcdabbb1a44097ba23f1521af66750384250e1f50ddc311d4c12a4a65040eb38af51d01aabd4c55ee1bc7d6ad115736b8456be21e10a830a244f36f3d14d00d688253439c86f4e43814b758e0254d78e1b33fe28ecf0d2476a90dac26d9bc9fff0adc0465bfef01bc46276d4ec2ced963904dedf411b2061c05569955987c7bb5ea0a59eb359bdb00abfb88101b6d576b275fa44b559ec0f8abb96b470918972d4814564509943b6cdf2b759ac0875ea9c1725a947b62797d55de4b4cbc2745a41e4940a8c2af96c0207fb27b02f7ee9a5f20f97a30956d1cf1191dbb8a56f3ac84ade963b7ccd0103b0f43598a67891c2cec8342f42ae2f594d7024774c80ae137d17d76ef5e3c83cdf43d4a6811eca16f2c86dbb522bc42e606301248554ae7013a8309cde8bf336404248c92b3a296807b3473cbdd257fc5e4effa78c8898ceec635be22e5c0537e85efe48bfe10cb7a470da590cc0a606f4566c0819b51d96bf34bfe24f078bab3c524a437bf8f74077389aff4726253791b2c584f238946d7b3c8e12a237f727a4afae74aa3c08bc911c6b9333db41e0fe3f7bca2ea1f9ab51fc18d370be4ba16cc9142edcb300b7b5703873847e59e45a50995950b73be56834837ef4541313119d705c0bf29791fa25bfa155845ad7d9381dda354571bc6539b2e172ff442419fdd9834d88b109e60aae3bdaadc0208f32aeb470b00e480813242db0066345e1bc4bb27c7e81704e5b387fa7c5f4b2c3ecbf86d7dea22413488d56f550eb6c857d93431ed2d53aaabdec7a6021b96f7bd5e68bb2ccf16306d8befa62dc724ff4d8e1d69520e1d1f9b8dc998bad11c5b91a6cc6280cadb713aeb4d5fbc3fffb184265d9d8d3981e10b9727d803ece05e7ef050b5360d077ac1de661b665ea6e6bb75974923bbf8d5ac3b8942b9242611715dc550709dea9b0a78a6f5607406206a701fc56c2e218d8b70bd166a86dcaee48767c93897f53747ecf884b5cc1ac37754379ef6b778720c41ae45bb82d211bb86422b929a4f0cae5a5b0c70e79f099b6e1acdccf5ebac4f751fdeca5812a0c7ebf17ee3ee8e12ca4b2b521b1feba5e362f5e84e524f92000e1529373d6c7072767e808b8e9fb1e6182942929fa6b1b3bbf201030f2d545f6095a0a8bc28393f4a59677f8093a4add9ebf1050f1d23598fa5b5cbf8fa000000000000000000000000000000000000000000000000000000000000000000111b26343f020aa698140026043023c316811074010002080504a0501024884900a4220900c29155b1f9930c0300010204060901"

	if hex.EncodeToString(signatureMessage) != expectedSigMsg {
		t.Error("SignatureMessage mismatch")
	}

	extractedMessage := ExtractMessage(signatureMessage)

	if !reflect.DeepEqual(msg, extractedMessage) {
		t.Error("ExtractedMessage mismatch")
	}
}

func TestExtractSignature(t *testing.T) {
	pk := PKHStrToBin(PK1)
	sk := SKHStrToBin(SK1)
	msg := []uint8{0, 1, 2, 4, 6, 9, 1}
	d := NewFromKeys(&pk, &sk)
	signatureMessage := d.Seal(msg)

	expectedSigMsg := "8c7c0ffc1dfd5b7de11e9c21c6274855bee171fc5022a70eb60da13ef1389f10ab435f06f39f46099802ac8aafaec59396ddcfd75f7e4cbdab72679b82d2e4e12584513b8c1f62cd4cd4b769debb9a47be2979a1f92c2f5b85827bd1495179bf1150bc773e670880c9183fe4123661dd18e413d53db17fb012a0d2db35ec73e1e8210f65960bbf00a599216f5ef60e7a0ce9b19e020803edeec074254a7a4c46591eeee6e6b13ea129493695987cfdea5e2c7b5ee3343bba46590178f74ad54375ff67b6b0541e6a94c378deb4a670413a1920810ada665047709ad4c95261c6aff1920945a9107d7c5cd243166e6f8a5cea8d3aa4ab75eae6a70e78d89342861f170b40d4af8ff0e283c2a631763a8ccc5870cac7e449f2a0bb4470520671ee35b061e8fb704fb341f9deb0edc7a3c912611c8c51a8180835251574b351e5bc2baa28f0c1904e764c5b880c421bcb22ce92d178e1aa5124ad78962c230b7d6ab78c02ef3a4365f64b702c00b94d744224640def49877ddc6633637eb898d035076568bd91f0f753b1b928455d5ed1ad8e2ecbad1432e46e3c2b8fa3be8e920e1cb3026f701baa9c586be0ed776ba28dd601c3cc0c39f632d53fc36de5081e6b8880a59b6dca06a5619c78a663f25dc141b280ac9c5a084c0bb8f8632217b5d4644de0cd4610905d39dd8372ea2c5215ad645fe5744f1e61fae0acef16536fc2a21845855bec29c0c47f3acf7184cd579113199bad5e93660c93bba5bf7da6a2a65108418097c31a6b52935c5af4d2e94a56b5bfea65350c74e4310ca0be4264dc601464bf0635cb2bab9109e4975646560753a8ed98a0777dcbb63acbe8a941f6f402489f56f3f9c81ea73ae5ad262de2cb49eb4a287684f134cb74f8d0311ffc45c48e0000400beacf00e78471e97be31d5236c0e290c35d15d82529590f85add6870e965725e2fc53c0ea72542b2cae2b3dc36acc683925f18d87b2bdc000f7cefaa9243367f67ebf5a45eeaa8c0cfb0e3e94e7897fc43841329e422fcbb2f661644e364eec4f96d446524b009d75f3bc403fd617194ffeaaf770122eda9917db5a7e5bdf64213fcdce1881ff2c97e2deb8d894e6e59d43a2aa5a02d386a9f0dcb8036a1948c4993c0f3c144213368227133574429af757593d0bc8cfbd1b18e003394d4fd56c49cc2b42148ac5d5a399317bdb2360c22e8a80c130d1952a6a39699b328ba05d2a2f96aafb85b22a088c66954a6bfe4bb5394e0c4de375d573b456e7deb248a86bb16a604e08cc88605146db0f5c109acd723fdd8ad99fe574ad611d14d52e67a04a0cb28577cb26c2509bbcd248afb1f4e6ec81e6645f4d5b19d09371b6ad9522528004707c15d07b5bf213770607df593478099622e60ab5154b62db617a89afed9eaf7cc79d1971fc79526e132b440f2eee0070ba4e81492aabdae081776144645af536ef05971526ff2310c829f4d496824bc8dfa24349b086c1811d12c62362b0f275dc1e472bb826ba1b2cd2dcc20196141c7a3b8790af1c2cae165e21864eee4fda4b47006b719bcf40696208265103f5780a5fd6621b083f85356565c774f75fcac54adb6d422bd8483d2e614db246f835e1161c5b1ee70075dfe1cfd2b120d273f757ad34e8b97d008fdaf38c797faece05e13621a9950462d2a5a34d53d7fb6d788f45b5399f8bcce55029ef8b91f5448426c73aff97ccaf2edc62f7012ac4626349fd2135c29f902cc584843ac0dd9e5bf2754a5e38c398702a9607daacb3320b9f0be199b8dbb7e668f643d0fb8d5bab8e3e661a543f3904e6dd8af1ddd43708ef305ab4e1f0ae88f9c16dc29187d89f7bccde9e4ef92da3fbfe76404aa97f492e3fe70ee55e31b04b19956d6ef356d29f5479c1473bfaa648028dbf72cafa9b10dda32b944b433e29c539e708b2f57b1a810943934106597b7e5007900aeb9f1799ce31d47c62b88460b4a5d84ba9157d54b0479405e07f96dc33d7be263e632b9e2afa5d95cd34cd01984740c09709b462d817e2e3b30e100b49889cdff48491919b14a863bb416dba48301196612093ddd376f70afd030562ee092740e7d63e5710bd73b707e6e92443f5ce7d12d9150e93435c1296f73a3edf62beea4859b9ecb195311498997edfb69bef0b9f60958e22d7576397f7f7b687b38a543c335c677eea154e21b3ee30d501bdd22b274955ef28a52dfec753ff9faf66042d0efbe229058dc500b673c70db4dc2631c6542874bf1c4f951bc1f9bc4fa5678e76b237b9802b75f1f58dc0dfe227f709bbb37e0386cd0b358ef5a7cac84fa6833e448650852aa3452f54147a67a2fc692e556096fef1d94535380b7ee580803e02cf58d030041da45f00e8031154c13a841d24b4f28ba1044640327eaed09120d163bdbe272a65e3e50e70f52a95962561584d09721fda3b0f3c6c9b1d334f08a41adccd96d8b3c46808cf388d2b48375ff8ddde137ec0f22cd5413f409ea034430fcdabbb1a44097ba23f1521af66750384250e1f50ddc311d4c12a4a65040eb38af51d01aabd4c55ee1bc7d6ad115736b8456be21e10a830a244f36f3d14d00d688253439c86f4e43814b758e0254d78e1b33fe28ecf0d2476a90dac26d9bc9fff0adc0465bfef01bc46276d4ec2ced963904dedf411b2061c05569955987c7bb5ea0a59eb359bdb00abfb88101b6d576b275fa44b559ec0f8abb96b470918972d4814564509943b6cdf2b759ac0875ea9c1725a947b62797d55de4b4cbc2745a41e4940a8c2af96c0207fb27b02f7ee9a5f20f97a30956d1cf1191dbb8a56f3ac84ade963b7ccd0103b0f43598a67891c2cec8342f42ae2f594d7024774c80ae137d17d76ef5e3c83cdf43d4a6811eca16f2c86dbb522bc42e606301248554ae7013a8309cde8bf336404248c92b3a296807b3473cbdd257fc5e4effa78c8898ceec635be22e5c0537e85efe48bfe10cb7a470da590cc0a606f4566c0819b51d96bf34bfe24f078bab3c524a437bf8f74077389aff4726253791b2c584f238946d7b3c8e12a237f727a4afae74aa3c08bc911c6b9333db41e0fe3f7bca2ea1f9ab51fc18d370be4ba16cc9142edcb300b7b5703873847e59e45a50995950b73be56834837ef4541313119d705c0bf29791fa25bfa155845ad7d9381dda354571bc6539b2e172ff442419fdd9834d88b109e60aae3bdaadc0208f32aeb470b00e480813242db0066345e1bc4bb27c7e81704e5b387fa7c5f4b2c3ecbf86d7dea22413488d56f550eb6c857d93431ed2d53aaabdec7a6021b96f7bd5e68bb2ccf16306d8befa62dc724ff4d8e1d69520e1d1f9b8dc998bad11c5b91a6cc6280cadb713aeb4d5fbc3fffb184265d9d8d3981e10b9727d803ece05e7ef050b5360d077ac1de661b665ea6e6bb75974923bbf8d5ac3b8942b9242611715dc550709dea9b0a78a6f5607406206a701fc56c2e218d8b70bd166a86dcaee48767c93897f53747ecf884b5cc1ac37754379ef6b778720c41ae45bb82d211bb86422b929a4f0cae5a5b0c70e79f099b6e1acdccf5ebac4f751fdeca5812a0c7ebf17ee3ee8e12ca4b2b521b1feba5e362f5e84e524f92000e1529373d6c7072767e808b8e9fb1e6182942929fa6b1b3bbf201030f2d545f6095a0a8bc28393f4a59677f8093a4add9ebf1050f1d23598fa5b5cbf8fa000000000000000000000000000000000000000000000000000000000000000000111b26343f020aa698140026043023c316811074010002080504a0501024884900a4220900c29155b1f9930c0300010204060901"

	if hex.EncodeToString(signatureMessage) != expectedSigMsg {
		t.Error("SignatureMessage mismatch")
	}

	extractedSignature := ExtractSignature(signatureMessage)

	if !reflect.DeepEqual(signatureMessage[:SigSizePacked], extractedSignature) {
		t.Error("ExtractedSignature mismatch")
	}
}
